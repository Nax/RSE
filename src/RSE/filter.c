#include <RSE/RSE_private.h>

static const double kImpulse[32] = {
     0,                     -2.66456540974866e-005,  1.69501013052948e-005,  0.000108188687516458,
    -0.000379821765557882,   0.000168208679848462,   0.00148146315577792,   -0.00322163405970455,
    -0.000178857958686936,   0.0106241146349445,    -0.0141731833850667,    -0.0107156774407109,
     0.0508304031186516,    -0.035086755629596,     -0.0970583299437547,     0.288134784730579,
     0.618926899554954,      0.288134784730579,     -0.0970583299437547,    -0.035086755629596,
     0.0508304031186517,    -0.0107156774407109,    -0.0141731833850667,     0.0106241146349445,
    -0.000178857958686936,  -0.00322163405970455,    0.00148146315577792,    0.000168208679848462,
    -0.000379821765557883,   0.000108188687516458,   1.69501013052949e-005, -2.66456540974866e-005
};

void rseFilter(float* buffer, size_t size, RseFilter* filter)
{
    float v;
    float tmp[BUFFER_SIZE_SRC + BUFFER_EXTRA];

    memcpy(tmp, filter->values, 32 * 4);
    memcpy(tmp + 32, buffer, size * 4);
    memcpy(filter->values, buffer + size - 32, 32 * 4);

    for (size_t i = 0; i < size; ++i)
    {
        v = 0.f;
        for (int j = 0; j < 32; ++j)
        {
            v += tmp[i + j] * kImpulse[j];
        }
        buffer[i] = v;
    }
}
